<html
  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
  lang="en"
  metal:use-macro="here/prefs_main_template/macros/master"
  i18n:domain="eea.google">

<body>
<div metal:fill-slot="prefs_configlet_main">
  <h1 class="documentFirstHeading"
    i18n:translate="title-google-analytics">Google Analytics Connection</h1>

  <a href=""
    class="link-parent"
    tal:define="portal_google python:here.portal_google.absolute_url()"
    tal:attributes="href string:${portal_google}"
    i18n:translate="label_up_to_plone_setup">Up to Site Setup</a>

  <p i18n:translate="description-google-analytics">
    Connect with Google Analytics API.
  </p>

  <div tal:define="token python:context.token" class="google-analytics">
    <!-- Token not registered -->
    <div tal:condition="not:token" tal:define="
      url string:https://www.google.com/accounts/AuthSubRequest;
      next string:${context/absolute_url}/register;
      scope string:https://www.google.com/analytics/feeds/;">
      <a tal:attributes="href string:$url?next=$next&scope=$scope&session=1"
        i18n:translate="">Register with Google</a>
    </div>

    <!-- Token registered-->
    <div tal:condition="token">
      <dl>
        <dt i18n:translate="">Authentication token:</dt>
        <dd>
          <span tal:content="token" class="connected">Stored token</span>
          <a tal:attributes="href string:${context/absolute_url}/register?token="
          i18n:attributes="title" title="Reinitialize token">Remove</a>
        </dd>
        <tal:status define="
          se python:view.status_error;
          status se/status;
          error se/error;
          class python:status != 200 and 'broken' or 'connected'">
          <dt i18n:translate="">Connection status:</dt>
          <dd tal:content="python:error" tal:attributes="class class">Status</dd>
        </tal:status>
      </dl>
    </div>

  </div>

</div>
</body>
</html>
